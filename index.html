<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>黑板座標座標拾取器</title>
    <style>
        body { background: #222; color: #fff; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; }
        .container { position: relative; margin-top: 20px; cursor: crosshair; }
        video { border: 2px solid #444; max-width: 800px; }
        #canvas { position: absolute; top: 0; left: 0; pointer-events: none; }
        .ui { margin-top: 20px; background: #333; padding: 15px; border-radius: 8px; width: 800px; }
        .pts-list { color: #0f0; font-family: monospace; background: #000; padding: 10px; height: 100px; overflow-y: scroll; margin-top: 10px; }
        button { padding: 8px 15px; cursor: pointer; margin-right: 5px; }
        .instruction { color: #aaa; font-size: 0.9em; margin-bottom: 10px; }
    </style>
</head>
<body>

    <h2>White6.mp4 座標拾取工具</h2>
    <p class="instruction">順序：1.左上 ➔ 2.右上 ➔ 3.右下 ➔ 4.左下 (點滿四點後自動紀錄)</p>

    <div class="container" id="wrapper">
        <video id="v" src="White6.mp4"></video>
        <canvas id="canvas"></canvas>
    </div>

    <div class="ui">
        <div class="controls">
            <button onclick="v.play()">播放</button>
            <button onclick="v.pause()">暫停</button>
            <button onclick="v.currentTime -= 1/30">前一幀</button>
            <button onclick="v.currentTime += 1/30">後一幀</button>
            <button onclick="clearPoints()" style="background:#822">清除目前點位</button>
            <button onclick="copyData()" style="background:#282">複製所有資料</button>
        </div>
        <div id="status">目前幀時間: 0s | 已記錄幀數: 0</div>
        <div class="pts-list" id="output">尚未記錄資料...</div>
    </div>

<script>
    const v = document.getElementById('v');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const wrapper = document.getElementById('wrapper');
    const output = document.getElementById('output');
    
    let points = [];
    let allData = {}; // { time: [p1, p2, p3, p4] }

    v.addEventListener('loadedmetadata', () => {
        canvas.width = v.clientWidth;
        canvas.height = v.clientHeight;
    });

    wrapper.onclick = (e) => {
        if (points.length >= 4) return;

        const rect = v.getBoundingClientRect();
        const x = ((e.clientX - rect.left) / rect.width).toFixed(4);
        const y = ((e.clientY - rect.top) / rect.height).toFixed(4);
        
        points.push({x, y});
        draw();

        if (points.length === 4) {
            const time = v.currentTime.toFixed(2);
            allData[time] = [...points];
            updateList();
            setTimeout(() => {
                points = [];
                draw();
            }, 500);
        }
    };

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#0f0";
        points.forEach((p, i) => {
            ctx.beginPath();
            ctx.arc(p.x * canvas.width, p.y * canvas.height, 5, 0, Math.PI*2);
            ctx.fill();
            ctx.fillText(i+1, p.x * canvas.width + 8, p.y * canvas.height - 8);
        });
    }

    function updateList() {
        output.innerText = JSON.stringify(allData, null, 2);
        document.getElementById('status').innerText = `目前幀時間: ${v.currentTime.toFixed(2)}s | 已記錄幀數: ${Object.keys(allData).length}`;
    }

    function clearPoints() {
        points = [];
        draw();
    }

    function copyData() {
        navigator.clipboard.writeText(JSON.stringify(allData));
        alert("資料已複製到剪貼簿！");
    }
</script>
</body>
</html>
