<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>狗狗黑板訊息 - 四角透視定位版</title>
    <style>
        :root {
            /* 粉筆質感設定 */
            --chalk-base: rgba(255, 255, 255, 0.82);
            --chalk-grain: url(#chalk-filter);
        }

        body {
            background-color: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        .phone-frame {
            position: relative;
            width: 360px;
            height: 640px;
            background: #111;
            border-radius: 40px;
            overflow: hidden;
        }

        #dogVideo {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
        }

        /* 核心：透視變形容器 */
        /* 您可以透過修改這裡的 transform 來精確對齊四角 */
        .perspective-container {
            position: absolute;
            z-index: 5;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            /* 這裡模擬了一個透視投影矩陣，您可以根據四角座標計算後替換 */
            /* 範例為：稍微向後仰且向左偏的透視 */
            transform-origin: 0 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .chalkboard-surface {
            width: 200px;
            height: 100px;
            background: rgba(255,255,255,0.05); /* 輔助對位用，正式版可設透明 */
            display: flex;
            justify-content: center;
            align-items: center;
            
            /* 讓文字跟黑板底紋融合 */
            mix-blend-mode: screen; 
            
            /* 加入您觀察到的黑板晃動動畫 */
            animation: board-vibration 4s infinite ease-in-out;
        }

        /* 針對文字的粉筆質感濾鏡 */
        .chalk-text-wrapper {
            filter: url(#chalk-grain) drop-shadow(0 0 1px rgba(255,255,255,0.3));
        }

        @keyframes board-vibration {
            0%, 100% { transform: translate(180px, 465px) rotate(-1deg); }
            30% { transform: translate(179px, 467px) rotate(-1.5deg); }
            60% { transform: translate(181px, 464px) rotate(-0.5deg); }
        }

        /* FlipBoard 模組樣式 */
        .flip-row { display: flex; gap: 3px; }
        .flip-unit { width: 22px; height: 36px; perspective: 200px; }
        .flip-card { 
            position: relative; width: 100%; height: 100%; 
            transform-style: preserve-3d; transition: transform 0.6s; 
        }
        .flip-card.is-flipped { transform: rotateX(-180deg); }
        .flip-face {
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
            display: flex; align-items: center; justify-content: center;
            font-size: 22px; font-weight: bold; color: var(--chalk-base);
            font-family: 'Marker Felt', 'Comic Sans MS', cursive;
        }
        .flip-face-back { transform: rotateX(180deg); }

        /* UI */
        .controls {
            position: absolute; bottom: 30px; width: 100%; z-index: 10;
            display: flex; flex-direction: column; align-items: center;
        }
        input {
            width: 70%; padding: 12px; border-radius: 20px; border: none;
            background: rgba(255,255,255,0.2); color: white; text-align: center;
            backdrop-filter: blur(10px); margin-bottom: 10px;
        }
        button { padding: 10px 30px; border-radius: 20px; border: none; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <svg style="display: none;">
        <filter id="chalk-filter">
            <feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="4" result="noise" />
            <feDisplacementMap in="SourceGraphic" in2="noise" scale="1.8" />
        </filter>
    </svg>

    <div class="phone-frame">
        <video id="dogVideo" autoplay loop muted playsinline>
            <source src="White6.mp4" type="video/mp4">
        </video>

        <div class="perspective-container">
            <div class="chalkboard-surface">
                <div class="chalk-text-wrapper">
                    <div id="flip-board" class="flip-row"></div>
                </div>
            </div>
        </div>

        <div class="controls">
            <input type="text" id="userInput" placeholder="輸入訊息..." maxlength="8">
            <button onclick="updateText()">寫上黑板</button>
        </div>
    </div>

    <script>
        // FlipBoard 模組
        const FlipBoard = (() => {
            const container = document.getElementById('flip-board');
            const MAX = 8;
            let current = new Array(MAX).fill("");

            const init = () => {
                container.innerHTML = "";
                for(let i=0; i<MAX; i++){
                    const u = document.createElement('div');
                    u.className = 'flip-unit';
                    u.innerHTML = `<div class="flip-card" id="s-${i}"><div class="flip-face f"></div><div class="flip-face b"></div></div>`;
                    container.appendChild(u);
                }
            };

            const write = (text) => {
                const chars = text.toUpperCase().padEnd(MAX, " ").split("");
                chars.forEach((c, i) => {
                    if (c === current[i]) return;
                    const card = document.getElementById(`s-${i}`);
                    const faces = card.querySelectorAll('.flip-face');
                    setTimeout(() => {
                        const target = card.classList.contains('is-flipped') ? faces[0] : faces[1];
                        target.textContent = c;
                        card.classList.toggle('is-flipped');
                    }, i * 70);
                });
                current = chars;
            };

            return { init, write };
        })();

        FlipBoard.init();
        setTimeout(() => FlipBoard.write("READY"), 1000);

        function updateText() {
            FlipBoard.write(document.getElementById('userInput').value);
        }
    </script>
</body>
</html>
