<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>狗狗黑板訊息 - 座標鎖定版</title>
    <style>
        body { background: #000; margin: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        
        .phone-frame {
            position: relative;
            width: 360px;
            height: 640px;
            background: #000;
            border-radius: 40px;
            border: 10px solid #222;
            overflow: hidden;
        }

        #v { position: absolute; width: 100%; height: 100%; object-fit: cover; }

        /* 這是疊加在影片上的畫布 */
        #drawingCanvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 5;
            pointer-events: none;
            /* 關鍵：讓文字融入黑板材質 */
            mix-blend-mode: screen;
            filter: blur(0.3px) brightness(1.2);
        }

        .ui {
            position: absolute; bottom: 30px; width: 100%; z-index: 10;
            display: flex; flex-direction: column; align-items: center; gap: 10px;
        }
        input { padding: 12px; border-radius: 20px; border: 1px solid #444; background: rgba(0,0,0,0.7); color: #fff; text-align: center; }
        button { padding: 8px 20px; border-radius: 20px; border: none; background: #fff; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div class="phone-frame">
        <video id="v" src="White6.mp4" autoplay loop muted playsinline></video>
        <canvas id="drawingCanvas"></canvas>

        <div class="ui">
            <input type="text" id="userInput" placeholder="輸入文字..." maxlength="8">
            <button onclick="updateMsg()">更新黑板</button>
        </div>
    </div>

<script>
    const v = document.getElementById('v');
    const canvas = document.getElementById('drawingCanvas');
    const ctx = canvas.getContext('2d');
    let currentText = "HELLO";

    // 您提供的精確座標資料
    const trackingData = {"3.64":[{"x":"0.1071","y":"0.6915"},{"x":"0.9238","y":"0.6809"},{"x":"0.9238","y":"0.9468"},{"x":"0.1905","y":"0.9839"}],"3.68":[{"x":"0.1619","y":"0.6955"},{"x":"0.8881","y":"0.6809"},{"x":"0.8833","y":"0.9190"},{"x":"0.1881","y":"0.9429"}],"3.71":[{"x":"0.1381","y":"0.6862"},{"x":"0.8548","y":"0.6624"},{"x":"0.8286","y":"0.8833"},{"x":"0.1929","y":"0.9230"}],"3.74":[{"x":"0.1429","y":"0.6770"},{"x":"0.8595","y":"0.6598"},{"x":"0.8500","y":"0.8820"},{"x":"0.1905","y":"0.9257"}],"3.78":[{"x":"0.1452","y":"0.6902"},{"x":"0.8476","y":"0.6585"},{"x":"0.8095","y":"0.8608"},{"x":"0.1881","y":"0.9018"}],"3.81":[{"x":"0.1452","y":"0.6717"},{"x":"0.8190","y":"0.6347"},{"x":"0.7857","y":"0.8423"},{"x":"0.1905","y":"0.8913"}],"3.84":[{"x":"0.1262","y":"0.6823"},{"x":"0.8024","y":"0.6518"},{"x":"0.7857","y":"0.8278"},{"x":"0.1833","y":"0.8820"}],"3.88":[{"x":"0.1667","y":"0.6809"},{"x":"0.8000","y":"0.6267"},{"x":"0.7500","y":"0.7987"},{"x":"0.2167","y":"0.8595"}],"3.91":[{"x":"0.1333","y":"0.6796"},{"x":"0.7976","y":"0.6188"},{"x":"0.7905","y":"0.8079"},{"x":"0.1952","y":"0.8675"}],"3.94":[{"x":"0.2000","y":"0.6664"},{"x":"0.8095","y":"0.6201"},{"x":"0.7762","y":"0.7775"},{"x":"0.2119","y":"0.8595"}],"3.98":[{"x":"0.2024","y":"0.6598"},{"x":"0.8024","y":"0.6148"},{"x":"0.7738","y":"0.7828"},{"x":"0.2071","y":"0.8436"}],"4.01":[{"x":"0.1929","y":"0.6558"},{"x":"0.8119","y":"0.6082"},{"x":"0.7786","y":"0.7722"},{"x":"0.2238","y":"0.8265"}],"4.04":[{"x":"0.2024","y":"0.6452"},{"x":"0.8143","y":"0.6042"},{"x":"0.7976","y":"0.7762"},{"x":"0.2452","y":"0.8198"}],"4.08":[{"x":"0.1952","y":"0.6452"},{"x":"0.8214","y":"0.6042"},{"x":"0.8000","y":"0.7735"},{"x":"0.2381","y":"0.8225"}],"4.11":[{"x":"0.2048","y":"0.6399"},{"x":"0.8310","y":"0.6122"},{"x":"0.8095","y":"0.7868"},{"x":"0.2357","y":"0.8145"}],"4.14":[{"x":"0.2143","y":"0.6320"},{"x":"0.8429","y":"0.6201"},{"x":"0.8405","y":"0.8040"},{"x":"0.2643","y":"0.8093"}],"4.18":[{"x":"0.2262","y":"0.6254"},{"x":"0.8571","y":"0.6227"},{"x":"0.8595","y":"0.8119"},{"x":"0.2667","y":"0.8093"}],"4.21":[{"x":"0.2238","y":"0.6201"},{"x":"0.8619","y":"0.6267"},{"x":"0.9048","y":"0.8331"},{"x":"0.2929","y":"0.8066"}],"4.24":[{"x":"0.2238","y":"0.6201"},{"x":"0.8810","y":"0.6227"},{"x":"0.8714","y":"0.8370"},{"x":"0.2952","y":"0.8106"}],"4.28":[{"x":"0.2333","y":"0.6161"},{"x":"0.8738","y":"0.6307"},{"x":"0.8857","y":"0.8463"},{"x":"0.2952","y":"0.8119"}],"4.31":[{"x":"0.2524","y":"0.6108"},{"x":"0.8714","y":"0.6307"},{"x":"0.9167","y":"0.8714"},{"x":"0.3071","y":"0.8145"}],"4.34":[{"x":"0.2524","y":"0.6095"},{"x":"0.8690","y":"0.6347"},{"x":"0.9119","y":"0.8714"},{"x":"0.3095","y":"0.8172"}],"4.38":[{"x":"0.2429","y":"0.6042"},{"x":"0.8690","y":"0.6294"},{"x":"0.8786","y":"0.8939"},{"x":"0.3095","y":"0.8159"}],"4.41":[{"x":"0.2643","y":"0.6056"},{"x":"0.8738","y":"0.6294"},{"x":"0.8833","y":"0.8860"},{"x":"0.3048","y":"0.8185"}],"4.44":[{"x":"0.2619","y":"0.5936"},{"x":"0.8643","y":"0.6373"},{"x":"0.8881","y":"0.8913"},{"x":"0.3000","y":"0.8198"}],"4.48":[{"x":"0.2357","y":"0.5976"},{"x":"0.8619","y":"0.6320"},{"x":"0.8595","y":"0.9018"},{"x":"0.2714","y":"0.8238"}],"4.51":[{"x":"0.2167","y":"0.5989"},{"x":"0.8548","y":"0.6320"},{"x":"0.8452","y":"0.8913"},{"x":"0.2571","y":"0.8225"}],"4.54":[{"x":"0.2119","y":"0.6016"},{"x":"0.8381","y":"0.6373"},{"x":"0.8310","y":"0.8833"},{"x":"0.2190","y":"0.8185"}],"4.58":[{"x":"0.2071","y":"0.5936"},{"x":"0.8429","y":"0.6333"},{"x":"0.8167","y":"0.8886"},{"x":"0.2095","y":"0.8291"}],"4.61":[{"x":"0.1738","y":"0.5950"},{"x":"0.8429","y":"0.6320"},{"x":"0.8095","y":"0.8926"},{"x":"0.2024","y":"0.8212"}],"4.64":[{"x":"0.1595","y":"0.5989"},{"x":"0.8119","y":"0.6373"},{"x":"0.7881","y":"0.8833"},{"x":"0.1524","y":"0.8265"}],"4.68":[{"x":"0.1667","y":"0.5963"},{"x":"0.8048","y":"0.6373"},{"x":"0.7738","y":"0.8727"},{"x":"0.1548","y":"0.8159"}],"4.71":[{"x":"0.1548","y":"0.6042"},{"x":"0.8000","y":"0.6347"},{"x":"0.7619","y":"0.8595"},{"x":"0.1429","y":"0.8291"}],"4.74":[{"x":"0.1571","y":"0.5989"},{"x":"0.8095","y":"0.6333"},{"x":"0.7714","y":"0.8542"},{"x":"0.1500","y":"0.8251"}],"4.78":[{"x":"0.1429","y":"0.6122"},{"x":"0.8071","y":"0.6294"},{"x":"0.7619","y":"0.8542"},{"x":"0.1333","y":"0.8317"}],"4.81":[{"x":"0.1571","y":"0.6148"},{"x":"0.8095","y":"0.6267"},{"x":"0.7571","y":"0.8317"},{"x":"0.1667","y":"0.8331"}],"4.84":[{"x":"0.1619","y":"0.6201"},{"x":"0.8190","y":"0.6227"},{"x":"0.7810","y":"0.8238"},{"x":"0.1905","y":"0.8317"}],"4.88":[{"x":"0.1786","y":"0.6267"},{"x":"0.8238","y":"0.6214"},{"x":"0.7952","y":"0.8106"},{"x":"0.2167","y":"0.8317"}],"4.91":[{"x":"0.1643","y":"0.6333"},{"x":"0.8190","y":"0.6227"},{"x":"0.8024","y":"0.8185"},{"x":"0.2167","y":"0.8357"}],"4.94":[{"x":"0.1952","y":"0.6360"},{"x":"0.8548","y":"0.6135"},{"x":"0.8286","y":"0.8093"},{"x":"0.2286","y":"0.8463"}],"4.98":[{"x":"0.2262","y":"0.6373"},{"x":"0.8548","y":"0.6122"},{"x":"0.8524","y":"0.8106"},{"x":"0.2810","y":"0.8463"}],"5.01":[{"x":"0.2405","y":"0.6386"},{"x":"0.8690","y":"0.6122"},{"x":"0.8810","y":"0.8106"},{"x":"0.2881","y":"0.8463"}],"5.04":[{"x":"0.2429","y":"0.6545"},{"x":"0.8810","y":"0.6148"},{"x":"0.8810","y":"0.8106"},{"x":"0.3143","y":"0.8436"}],"5.08":[{"x":"0.2500","y":"0.6452"},{"x":"0.9048","y":"0.6069"},{"x":"0.9048","y":"0.8093"},{"x":"0.3095","y":"0.8503"}],"5.11":[{"x":"0.2643","y":"0.6479"},{"x":"0.9048","y":"0.6161"},{"x":"0.9429","y":"0.8212"},{"x":"0.3214","y":"0.8542"}],"5.14":[{"x":"0.2667","y":"0.6545"},{"x":"0.9262","y":"0.6175"},{"x":"0.9643","y":"0.8265"},{"x":"0.3310","y":"0.8582"}],"5.18":[{"x":"0.2762","y":"0.6426"},{"x":"0.9333","y":"0.6227"},{"x":"0.9738","y":"0.8384"},{"x":"0.3262","y":"0.8595"}],"5.21":[{"x":"0.2619","y":"0.6466"},{"x":"0.9381","y":"0.6267"},{"x":"0.9524","y":"0.8542"},{"x":"0.3167","y":"0.8661"}],"5.24":[{"x":"0.2524","y":"0.6505"},{"x":"0.9095","y":"0.6267"},{"x":"0.9524","y":"0.8503"},{"x":"0.3167","y":"0.8582"}],"5.28":[{"x":"0.2619","y":"0.6426"},{"x":"0.9429","y":"0.6280"},{"x":"0.9381","y":"0.8582"},{"x":"0.3190","y":"0.8529"}],"5.31":[{"x":"0.2500","y":"0.6399"},{"x":"0.9167","y":"0.6386"},{"x":"0.9357","y":"0.8780"},{"x":"0.2881","y":"0.8648"}],"5.34":[{"x":"0.2333","y":"0.6399"},{"x":"0.8952","y":"0.6426"},{"x":"0.8881","y":"0.8847"},{"x":"0.2738","y":"0.8595"}],"5.38":[{"x":"0.2214","y":"0.6307"},{"x":"0.8714","y":"0.6518"},{"x":"0.8833","y":"0.8820"},{"x":"0.2357","y":"0.8608"}],"5.41":[{"x":"0.2214","y":"0.6347"},{"x":"0.8643","y":"0.6452"},{"x":"0.8643","y":"0.8860"},{"x":"0.2500","y":"0.8529"}],"5.44":[{"x":"0.2119","y":"0.6333"},{"x":"0.8643","y":"0.6545"},{"x":"0.8429","y":"0.8860"},{"x":"0.2381","y":"0.8516"}],"5.48":[{"x":"0.1952","y":"0.6320"},{"x":"0.8357","y":"0.6638"},{"x":"0.7976","y":"0.8807"},{"x":"0.2167","y":"0.8410"}],"5.51":[{"x":"0.1881","y":"0.6294"},{"x":"0.8286","y":"0.6638"},{"x":"0.8286","y":"0.8873"},{"x":"0.2048","y":"0.8476"}],"5.54":[{"x":"0.1976","y":"0.6294"},{"x":"0.8286","y":"0.6624"},{"x":"0.8071","y":"0.8688"},{"x":"0.1714","y":"0.8503"}],"5.58":[{"x":"0.1881","y":"0.6294"},{"x":"0.8381","y":"0.6611"},{"x":"0.7905","y":"0.8966"},{"x":"0.1643","y":"0.8516"}],"5.61":[{"x":"0.1905","y":"0.6294"},{"x":"0.8310","y":"0.6585"},{"x":"0.7738","y":"0.8780"},{"x":"0.1786","y":"0.8476"}],"5.64":[{"x":"0.1738","y":"0.6320"},{"x":"0.8333","y":"0.6558"},{"x":"0.7857","y":"0.8688"},{"x":"0.1905","y":"0.8476"}],"5.68":[{"x":"0.1786","y":"0.6333"},{"x":"0.8333","y":"0.6492"},{"x":"0.7976","y":"0.8675"},{"x":"0.1881","y":"0.8556"}],"5.71":[{"x":"0.1905","y":"0.6426"},{"x":"0.8595","y":"0.6558"},{"x":"0.8119","y":"0.8635"},{"x":"0.2238","y":"0.8582"}],"5.74":[{"x":"0.1929","y":"0.6413"},{"x":"0.8381","y":"0.6466"},{"x":"0.8214","y":"0.8516"},{"x":"0.2119","y":"0.8476"}],"5.78":[{"x":"0.2095","y":"0.6439"},{"x":"0.8500","y":"0.6479"},{"x":"0.8357","y":"0.8622"},{"x":"0.2238","y":"0.8569"}],"5.81":[{"x":"0.2167","y":"0.6426"},{"x":"0.8643","y":"0.6373"},{"x":"0.8643","y":"0.8595"},{"x":"0.2619","y":"0.8635"}],"5.84":[{"x":"0.2190","y":"0.6558"},{"x":"0.8667","y":"0.6307"},{"x":"0.8643","y":"0.8569"},{"x":"0.2786","y":"0.8701"}],"5.88":[{"x":"0.2500","y":"0.6571"},{"x":"0.8738","y":"0.6373"},{"x":"0.8929","y":"0.8476"},{"x":"0.2833","y":"0.8794"}],"5.91":[{"x":"0.2262","y":"0.6532"},{"x":"0.8905","y":"0.6347"},{"x":"0.8905","y":"0.8489"},{"x":"0.2976","y":"0.8661"}],"5.94":[{"x":"0.2333","y":"0.6638"},{"x":"0.8905","y":"0.6347"},{"x":"0.9286","y":"0.8489"},{"x":"0.2905","y":"0.8661"}],"5.98":[{"x":"0.2452","y":"0.6624"},{"x":"0.8929","y":"0.6320"},{"x":"0.9048","y":"0.8503"},{"x":"0.3024","y":"0.8714"}],"6.01":[{"x":"0.2548","y":"0.6558"},{"x":"0.8952","y":"0.6320"},{"x":"0.9167","y":"0.8556"},{"x":"0.3095","y":"0.8701"}],"6.04":[{"x":"0.2429","y":"0.6651"},{"x":"0.8929","y":"0.6347"},{"x":"0.9000","y":"0.8503"},{"x":"0.2929","y":"0.8741"}]};

    // 初始化畫布解析度
    v.addEventListener('loadedmetadata', () => {
        canvas.width = v.clientWidth;
        canvas.height = v.clientHeight;
        animate();
    });

    function updateMsg() {
        currentText = document.getElementById('userInput').value.toUpperCase();
    }

    // 繪製粉筆文字
    function drawChalkText(pts, text) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // 1. 建立一個暫時的 Canvas 來畫正的字
        const tempCanvas = document.createElement('canvas');
        tempCanvas.width = 400;
        tempCanvas.height = 100;
        const tCtx = tempCanvas.getContext('2d');
        
        tCtx.fillStyle = "rgba(255,255,255,0.85)";
        tCtx.font = "bold 60px 'Comic Sans MS', cursive";
        tCtx.textAlign = "center";
        tCtx.textBaseline = "middle";
        
        // 模擬粉筆顆粒感 (多畫幾次微偏移)
        tCtx.fillText(text, 200, 50);
        tCtx.globalAlpha = 0.3;
        tCtx.fillText(text, 201, 51);

        // 2. 獲取四個角的目標座標 (px)
        const p1 = { x: pts[0].x * canvas.width, y: pts[0].y * canvas.height }; // 左上
        const p2 = { x: pts[1].x * canvas.width, y: pts[1].y * canvas.height }; // 右上
        const p3 = { x: pts[2].x * canvas.width, y: pts[2].y * canvas.height }; // 右下
        const p4 = { x: pts[3].x * canvas.width, y: pts[3].y * canvas.height }; // 左下

        // 3. 執行四點形變 (利用 Canvas 的 transform 模擬透視)
        // 注意：標準 Canvas API 不支援完整的 4-point perspective，
        // 這裡我們用「切片法」或簡單的「斜切」來模擬，保證字體會出現在這四點範圍內
        ctx.save();
        
        // 這裡計算中心點與旋轉角度，確保字出現在黑板中央
        const centerX = (p1.x + p2.x + p3.x + p4.x) / 4;
        const centerY = (p1.y + p2.y + p3.y + p4.y) / 4;
        const angle = Math.atan2(p2.y - p1.y, p2.x - p1.x);
        const boardWidth = Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));
        
        ctx.translate(centerX, centerY);
        ctx.rotate(angle);
        
        // 縮放到黑板大小
        const scale = boardWidth / tempCanvas.width;
        ctx.scale(scale, scale);
        
        ctx.drawImage(tempCanvas, -200, -50);
        ctx.restore();
    }

    function animate() {
        const time = v.currentTime.toFixed(2);
        const keys = Object.keys(trackingData).map(Number);
        
        // 找出最接近的時間點
        const closestTime = keys.reduce((prev, curr) => {
            return (Math.abs(curr - time) < Math.abs(prev - time) ? curr : prev);
        });

        if (trackingData[closestTime]) {
            drawChalkText(trackingData[closestTime], currentText);
        }

        requestAnimationFrame(animate);
    }
</script>
</body>
</html>
